/*! chessboard.js | (c) 2013 Chris Oakman | | Forked from v0.3.0 by Cody Mims | MIT License chessboardjs.com/license */
(function(){function ka(b,d,h){var n=0,l=!1,r=[],B=function(){n=0;l&&(l=!1,K())},K=function(){n=window.setTimeout(B,d);b.apply(h,r)};return function(I){r=arguments;n?l=!0:K()}}function N(){return"xxxx-xxxx-xxxx-xxxx-xxxx-xxxx-xxxx-xxxx".replace(/x/g,function(b){return(16*Math.random()|0).toString(16)})}function t(b){return JSON.parse(JSON.stringify(b))}function la(b){b=b.split(".");return{major:parseInt(b[0],10),minor:parseInt(b[1],10),patch:parseInt(b[2],10)}}function ya(b,d){b=la(b);d=la(d);return 1E10*
b.major+1E5*b.minor+b.patch>=1E10*d.major+1E5*d.minor+d.patch}function V(b,d){for(var h in d)if(d.hasOwnProperty(h))for(var n="{"+h+"}",l=d[h];-1!==b.indexOf(n);)b=b.replace(n,l);return b}function G(b){return"string"===typeof b}function E(b){return"function"===typeof b}function ma(b){return"number"===typeof b&&isFinite(b)&&Math.floor(b)===b}function R(b){return"fast"===b||"slow"===b?!0:ma(b)?0<=b:!1}function y(b){return G(b)&&-1!==b.search(/^[a-h][1-8]$/)}function na(b){if(!G(b))return!1;b=b.replace(/ .+$/,
"");b=b.replace(/8/g,"11111111").replace(/7/g,"1111111").replace(/6/g,"111111").replace(/5/g,"11111").replace(/4/g,"1111").replace(/3/g,"111").replace(/2/g,"11");b=b.split("/");if(8!==b.length)return!1;for(var d=0;8>d;d++)if(8!==b[d].length||-1!==b[d].search(/[^kqrnbpKQRNBP1]/))return!1;return!0}function oa(b){if(!k.isPlainObject(b))return!1;for(var d in b)if(b.hasOwnProperty(d)){var h;(h=!y(d))||(h=b[d],h=!(G(h)&&-1!==h.search(/^[bw][KQRNBP]$/)));if(h)return!1}return!0}function S(b){b=b.replace(/ .+$/,
"");b=b.split("/");for(var d={},h=8,n=0;8>n;n++){for(var l=b[n].split(""),r=0,B=0;B<l.length;B++)if(-1!==l[B].search(/[1-8]/)){var K=parseInt(l[B],10);r+=K}else{K=L[r]+h;var I=l[B];I=I.toLowerCase()===I?"b"+I.toUpperCase():"w"+I.toUpperCase();d[K]=I;r+=1}--h}return d}function W(b){for(var d="",h=8,n=0;8>n;n++){for(var l=0;8>l;l++){var r=L[l]+h;b.hasOwnProperty(r)?(r=b[r].split(""),r="w"===r[0]?r[1].toUpperCase():r[1].toLowerCase(),d+=r):d+="1"}7!==n&&(d+="/");--h}return d=d.replace(/11111111/g,"8").replace(/1111111/g,
"7").replace(/111111/g,"6").replace(/11111/g,"5").replace(/1111/g,"4").replace(/111/g,"3").replace(/11/g,"2")}function za(b,d){var h=b.split(""),n=L.indexOf(h[0])+1;h=parseInt(h[1],10);var l=d.split(""),r=L.indexOf(l[0])+1;l=parseInt(l[1],10);n=Math.abs(n-r);h=Math.abs(h-l);return n>=h?n:h}function Aa(b){for(var d=[],h=0;8>h;h++)for(var n=0;8>n;n++){var l=L[h]+(n+1);b!==l&&d.push({square:l,distance:za(b,l)})}d.sort(function(r,B){return r.distance-B.distance});b=[];for(h=0;h<d.length;h++)b.push(d[h].square);
return b}function Ba(b){"start"===b?b={position:t(ca)}:na(b)?b={position:S(b)}:oa(b)&&(b={position:t(b)});k.isPlainObject(b)||(b={});return b}function Ca(b){"black"!==b.orientation&&(b.orientation="white");!1!==b.showNotation&&(b.showNotation=!0);!0!==b.draggable&&(b.draggable=!1);"trash"!==b.dropOffBoard&&(b.dropOffBoard="snapback");!0!==b.sparePieces&&(b.sparePieces=!1);b.sparePieces&&(b.draggable=!0);b.hasOwnProperty("pieceTheme")&&(G(b.pieceTheme)||E(b.pieceTheme))||(b.pieceTheme="img/chesspieces/wikipedia/{piece}.png");
R(b.appearSpeed)||(b.appearSpeed=200);R(b.moveSpeed)||(b.moveSpeed=250);R(b.snapbackSpeed)||(b.snapbackSpeed=60);R(b.snapSpeed)||(b.snapSpeed=30);R(b.trashSpeed)||(b.trashSpeed=100);var d=b.dragThrottleRate;ma(d)&&1<=d||(b.dragThrottleRate=20);return b}function Da(b){if(""===b)return window.alert("Chessboard Error 1001: The first argument to Chessboard() cannot be an empty string.\n\nExiting\u2026"),!1;G(b)&&"#"!==b.charAt(0)&&(b="#"+b);b=k(b);return 1!==b.length?(window.alert("Chessboard Error 1003: The first argument to Chessboard() must be the ID of a DOM node, an ID query selector, or a single DOM node.\n\nExiting\u2026"),
!1):b}var k=window.jQuery,pa=document.createElement("img");pa.src="img/buttons/build.png";var qa=document.createElement("img");qa.src="img/buttons/snipe.png";var ra=document.createElement("img");ra.src="img/buttons/cloak.png";var sa=document.createElement("img");sa.src="img/buttons/stun.png";var L="abcdefgh".split(""),ca=S("rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR"),m={alpha:"alpha-d2270",black:"black-3c85d",board:"board-b72b1",chessboard:"chessboard-63f37",clearfix:"clearfix-7da63",highlight1:"highlight1-32417",
highlight2:"highlight2-9c5d2",notation:"notation-322f9",numeric:"numeric-fc462",piece:"piece-417db",row:"row-5277c",sparePieces:"spare-pieces-7492f",sparePiecesBottom:"spare-pieces-bottom-ae20f",sparePiecesTop:"spare-pieces-top-4028b",square:"square-55d63",white:"white-1e1d7"};window.Chessboard=function(b,d){function h(a,e,c){if(!0===d.hasOwnProperty("showErrors")&&!1!==d.showErrors){var f="Chessboard Error "+a+": "+e;"console"===d.showErrors&&"object"===typeof console&&"function"===typeof console.log?
(console.log(f),2<=arguments.length&&console.log(c)):"alert"===d.showErrors?(c&&(f+="\n\n"+JSON.stringify(c)),window.alert(f)):E(d.showErrors)&&d.showErrors(a,e,c)}}function n(a){return String(a).replace(/[&<>"'`=\/]/g,function(e){return Ea[e]})}function l(a,e,c){a=n(a);c=n(c);var f=a;E(d.pieceTheme)?f=d.pieceTheme(f):G(d.pieceTheme)?f=V(d.pieceTheme,{piece:f}):(h(8272,"Unable to build image source for config.pieceTheme."),f="");f='<img src="'+f+'" ';G(c)&&""!==c&&(f+='id="'+c+'" ');f+='alt="" class="{piece}" data-piece="'+
a+'" style="width:'+C+"px;height:"+C+"px;";e&&(f+="display:none;");return V(f+'" />',m)}function r(a){var e="wK wQ wR wB wN wP wW".split(" ");"black"===a&&(e="bK bQ bR bB bN bP bW".split(" "));a="";for(var c=0;c<e.length;c++)a+=l(e[c],!1,X[e[c]]);return a}function B(a,e,c,f){a=k("#"+v[a]);var p=a.offset(),u=k("#"+v[e]),g=u.offset(),z=N();k("body").append(l(c,!0,z));var F=k("#"+z);F.css({display:"",position:"absolute",top:p.top,left:p.left});a.find("."+m.piece).remove();F.animate(g,{duration:d.moveSpeed,
complete:function(){k("#"+v[e]).find("."+m.piece).remove();u.append(l(c));F.remove();E(f)&&f()}})}function K(a,e,c){var f=k("#"+X[a]).offset(),p=k("#"+v[e]);e=p.offset();var u=N();k("body").append(l(a,!0,u));var g=k("#"+u);g.css({display:"",position:"absolute",left:f.left,top:f.top});g.animate(e,{duration:d.moveSpeed,complete:function(){p.find("."+m.piece).remove();p.append(l(a));g.remove();E(c)&&c()}})}function I(a,e,c){function f(){p+=1;if(p===a.length&&(T(),E(d.onMoveEnd)))d.onMoveEnd(t(e),t(c))}
if(0!==a.length)for(var p=0,u=0;u<a.length;u++){var g=a[u];"clear"===g.type?k("#"+v[g.square]+" ."+m.piece).fadeOut(d.trashSpeed,f):"add"!==g.type||d.sparePieces?"add"===g.type&&d.sparePieces?K(g.piece,g.square,f):"move"===g.type&&B(g.source,g.destination,g.piece,f):k("#"+v[g.square]).append(l(g.piece,!0)).find("."+m.piece).fadeIn(d.appearSpeed,f)}}function T(){J.find("."+m.piece).remove();for(var a in q)q.hasOwnProperty(a)&&k("#"+v[a]).append(l(q[a]))}function da(){var a=J,e=a.html;var c=A;"black"!==
c&&(c="white");var f="",p=t(L),u=8;"black"===c&&(p.reverse(),u=1);for(var g="white",z=0;8>z;z++){f+='<div class="{row}">';for(var F=0;8>F;F++){var O=p[F]+u;f+='<div class="{square} '+m[g]+" square-"+O+'" style="width:'+C+"px;height:"+C+'px;" id="'+v[O]+'" data-square="'+O+'">';if(d.showNotation){if("white"===c&&1===u||"black"===c&&8===u)f+='<div class="{notation} {alpha}">'+p[F]+"</div>";0===F&&(f+='<div class="{notation} {numeric}">'+u+"</div>")}f+="</div>";g="white"===g?"black":"white"}f+='<div class="{clearfix}"></div></div>';
g="white"===g?"black":"white";u="white"===c?u-1:u+1}c=V(f,m);e.call(a,c);T();d.sparePieces&&("white"===A?(ea.html(r("black")),fa.html(r("white"))):(ea.html(r("white")),fa.html(r("black"))))}function Y(a){var e=t(q),c=t(a),f=W(e),p=W(c);if(f!==p){if(E(d.onChange))d.onChange(e,c);q=a}}function ha(a,e){for(var c in U)if(U.hasOwnProperty(c)){var f=U[c];if(a>=f.left&&a<f.left+C&&e>=f.top&&e<f.top+C)return c}return"offboard"}function Z(){J.find("."+m.square).removeClass(m.highlight1+" "+m.highlight2)}function Fa(){if("spare"===
x)ta();else{Z();var a=k("#"+v[x]).offset();P.animate(a,{duration:d.snapbackSpeed,complete:function(){T();P.css("display","none");if(E(d.onSnapbackEnd))d.onSnapbackEnd(M,x,t(q),A)}});H=!1}}function ta(){Z();var a=t(q);delete a[x];Y(a);T();P.fadeOut(d.trashSpeed);H=!1}function ua(a){Z();var e=t(q);delete e[x];e[a]=M;Y(e);H=!1}function aa(a,e){if(!1!==d.onDragStart(e)){H=!0;M=e;x=a;Q="spare"===a?"offboard":a;U={};for(var c in v)v.hasOwnProperty(c)&&(U[c]=k("#"+v[c]).offset());if("spare"!==a){k("#"+v[a]).addClass(m.highlight1);
specialSquare=a;specialPiece=e;switch(specialPiece.charAt(1)){case "K":c=sa;break;case "N":c=qa;break;case "R":c=pa;break;case "B":if(k("#"+v[a]).hasClass("cloaked"))return;c=ra;break;default:return}0<specialMoves(a,specialPiece).length?c.className="special":c.className="special inactive";c.style.display="";document.getElementById(v[a]).appendChild(c)}}}function va(a,e){var c=ha(a,e);if(c!==Q){y(Q)&&k("#"+v[Q]).removeClass(m.highlight2);y(c)&&k("#"+v[c]).addClass(m.highlight2);if(E(d.onDragMove))d.onDragMove(c,
Q,x,M,t(q),A);Q=c}}function ba(a){var e="drop";"offboard"===a&&"snapback"===d.dropOffBoard&&(e="snapback");"offboard"===a&&"trash"===d.dropOffBoard&&(e="trash");if(E(d.onDrop)){var c=t(q);"spare"===x&&y(a)&&(c[a]=M);y(x)&&"offboard"===a&&delete c[x];y(x)&&y(a)&&(delete c[x],c[a]=M);var f=t(q);c=d.onDrop(x,a,M,c,f,A);if("snapback"===c||"trash"===c)e=c}"snapback"===e?Fa():"trash"===e?ta():"drop"===e&&(e=document.getElementsByClassName("square-"+x),e[0].classList.contains("cloaked")?(document.getElementsByClassName("square-"+
a)[0].classList.add("cloaked"),ua(a),e[0].classList.remove("cloaked")):(B(x,a,M),ua(a)))}function Ga(a){a.preventDefault()}function Ha(a){if(a.target.matches(".special")&&!a.target.parentElement.matches(".cloaked"))if(a.target.matches(".inactive"))ba("offboard");else{inSpecial=!0;var e=specialMoves(specialSquare,specialPiece);removeHighlights();k(".special").hide();if("B"==specialPiece.charAt(1))a.target.parentElement.classList.add("cloaked"),specialSquare="offboard",endSpecial(),advanceTurn(),endTurn();
else for(a=0;a<e.length;a++)highlightSquare(e[a],"red")}else H?inSpecial?endSpecial():(a=ha(a.pageX,a.pageY),ba(a)):d.draggable&&(e=k(this).attr("data-square"),y(e)&&q.hasOwnProperty(e)&&!a.target.matches(".inactive")&&aa(e,q[e]))}function Ia(a){d.draggable&&(a=k(this).attr("data-square"),y(a)&&q.hasOwnProperty(a)&&aa(a,q[a]))}function Ja(){if(d.sparePieces){var a=k(this).attr("data-piece");aa("spare",a)}}function Ka(a){d.sparePieces&&(a=k(this).attr("data-piece"),aa("spare",a))}function La(a){H&&
(a=ha(a.originalEvent.changedTouches[0].pageX,a.originalEvent.changedTouches[0].pageY),ba(a))}function Ma(a){if(!H&&E(d.onMouseoverSquare)&&(a=k(a.currentTarget).attr("data-square"),y(a))){var e=!1;q.hasOwnProperty(a)&&(e=q[a]);d.onMouseoverSquare(a,e,t(q),A)}}function Na(a){if(!H&&(a=k(a.currentTarget).attr("data-square"),y(a)))d.onMouseoutSquare()}if(typeof window.$&&k.fn&&k.fn.jquery&&ya(k.fn.jquery,"1.8.3"))var wa=!0;else window.alert("Chessboard Error 1005: Unable to find a valid version of jQuery. Please include jQuery 1.8.3 or higher on the page\n\nExiting\u2026"),
wa=!1;if(!wa)return null;var D=Da(b);if(!D)return null;d=Ba(d);d=Ca(d);var J=null,P=null,ea=null,fa=null,w={},xa=2,A="white",q={},M=null,Q=null,x=null,H=!1,X={},v={},U={},C=16,Ea={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"};w.clear=function(a){w.position({},a)};w.destroy=function(){D.html("");P.remove();D.unbind()};w.fen=function(){return w.position("fen")};w.flip=function(){return w.orientation("flip")};w.move=function(){if(0!==arguments.length){for(var a=
!0,e={},c=0;c<arguments.length;c++)if(!1===arguments[c])a=!1;else{var f=arguments[c];G(f)?(f=f.split("-"),f=2!==f.length?!1:y(f[0])&&y(f[1])):f=!1;f?(f=arguments[c].split("-"),e[f[0]]=f[1]):h(2826,"Invalid move passed to the move method.",arguments[c])}c=t(q);for(var p in e)e.hasOwnProperty(p)&&c.hasOwnProperty(p)&&(f=c[p],delete c[p],c[e[p]]=f);w.position(c,a);return c}};w.orientation=function(a){if(0===arguments.length)return A;if("white"===a||"black"===a)return A=a,da(),A;if("flip"===a)return A=
"white"===A?"black":"white",da(),A;h(5482,"Invalid value passed to the orientation method.",a)};w.position=function(a,e){if(0===arguments.length)return t(q);if(G(a)&&"fen"===a.toLowerCase())return W(q);a=G(a)&&"start"===a.toLowerCase()?t(ca):S(a);!1!==e&&(e=!0);if(e){var c=q,f=a;c=t(c);f=t(f);var p=[],u={},g;for(g in f)f.hasOwnProperty(g)&&c.hasOwnProperty(g)&&c[g]===f[g]&&(delete c[g],delete f[g]);for(g in f)if(f.hasOwnProperty(g)){a:{var z=c;for(var F=f[g],O=Aa(g),ia=0;ia<O.length;ia++){var ja=
O[ia];if(z.hasOwnProperty(ja)&&z[ja]===F){z=ja;break a}}z=!1}z&&(p.push({type:"move",source:z,destination:g,piece:f[g]}),delete c[z],delete f[g],u[g]=!0)}for(g in f)f.hasOwnProperty(g)&&(p.push({type:"add",square:g,piece:f[g]}),delete f[g]);for(g in c)c.hasOwnProperty(g)&&!u.hasOwnProperty(g)&&(p.push({type:"clear",square:g,piece:c[g]}),delete c[g]);I(p,q,a);Y(a)}else Y(a),T()};w.resize=function(){var a=parseInt(D.width(),10);if(!a||0>=a)C=0;else{for(--a;0!==a%8&&0<a;)--a;C=a/8}J.css("width",8*C+
"px");P.css({height:C,width:C});d.sparePieces&&D.find("."+m.sparePieces).css("paddingLeft",C+xa+"px");da()};w.removeYellowHighlights=function(){Z()};w.start=function(a){w.position("start",a)};w.stopDraggedPiece=function(a){ba(a)};var Oa=ka(function(a){H&&va(a.pageX,a.pageY)},d.dragThrottleRate),Pa=ka(function(a){H&&(a.preventDefault(),va(a.originalEvent.changedTouches[0].pageX,a.originalEvent.changedTouches[0].pageY))},d.dragThrottleRate);A=d.orientation;d.hasOwnProperty("position")&&("start"===d.position?
q=t(ca):na(d.position)?q=S(d.position):oa(d.position)?q=t(d.position):h(7263,"Invalid value passed to config.position.",d.position));(function(){for(var a=0;a<L.length;a++)for(var e=1;8>=e;e++){var c=L[a]+e;v[c]=c+"-"+N()}e="KQRNBP".split("");for(a=0;a<e.length;a++){c="w"+e[a];var f="b"+e[a];X[c]=c+"-"+N();X[f]=f+"-"+N()}a=D.html;e=d.sparePieces;c='<div class="{chessboard}">';e&&(c+='<div class="{sparePieces} {sparePiecesTop}"></div>');c+='<div class="{board}"></div>';e&&(c+='<div class="{sparePieces} {sparePiecesBottom}"></div>');
e=V(c+"</div>",m);a.call(D,e);J=D.find("."+m.board);d.sparePieces&&(ea=D.find("."+m.sparePiecesTop),fa=D.find("."+m.sparePiecesBottom));a=N();k("body").append(l("wP",!0,a));P=k("#"+a);xa=parseInt(J.css("borderLeftWidth"),10);w.resize()})();(function(){k("body").on("mousedown mousemove","."+m.piece,Ga);J.on("mouseup","."+m.square,Ha);D.on("mouseup","."+m.sparePieces+" ."+m.piece,Ja);J.on("mouseenter","."+m.square,Ma).on("mouseleave","."+m.square,Na);var a=k(window);a.on("mousemove",Oa);"ontouchstart"in
document.documentElement&&(J.on("touchstart","."+m.square,Ia),D.on("touchstart","."+m.sparePieces+" ."+m.piece,Ka),a.on("touchmove",Pa).on("touchend",La))})();return w};window.Chessboard.fenToObj=S;window.Chessboard.objToFen=W})();