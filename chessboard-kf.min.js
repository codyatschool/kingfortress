/*! chessboard.js | (c) 2013 Chris Oakman | | Forked from v0.3.0 by Cody Mims | MIT License chessboardjs.com/license */
var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.findInternal=function(d,l,f){d instanceof String&&(d=String(d));for(var m=d.length,x=0;x<m;x++){var H=d[x];if(l.call(f,H,x,d))return{i:x,v:H}}return{i:-1,v:void 0}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(d,l,f){d!=Array.prototype&&d!=Object.prototype&&(d[l]=f.value)};$jscomp.getGlobal=function(d){return"undefined"!=typeof window&&window===d?d:"undefined"!=typeof global&&null!=global?global:d};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.polyfill=function(d,l,f,m){if(l){f=$jscomp.global;d=d.split(".");for(m=0;m<d.length-1;m++){var x=d[m];x in f||(f[x]={});f=f[x]}d=d[d.length-1];m=f[d];l=l(m);l!=m&&null!=l&&$jscomp.defineProperty(f,d,{configurable:!0,writable:!0,value:l})}};$jscomp.polyfill("Array.prototype.find",function(d){return d?d:function(d,f){return $jscomp.findInternal(this,d,f).v}},"es6","es3");
(function(){function d(a,b,oa){var f=0,c=!1,d=[],g=function(){f=0;c&&(c=!1,l())},l=function(){f=window.setTimeout(g,b);a.apply(oa,d)};return function(a){d=arguments;f?c=!0:l()}}function l(){return"xxxx-xxxx-xxxx-xxxx-xxxx-xxxx-xxxx-xxxx".replace(/x/g,function(a){return(16*Math.random()|0).toString(16)})}function f(a){return JSON.parse(JSON.stringify(a))}function m(a){a=a.split(".");return{major:parseInt(a[0],10),minor:parseInt(a[1],10),patch:parseInt(a[2],10)}}function x(a,b){a=m(a);b=m(b);return 1E10*
a.major+1E5*a.minor+a.patch>=1E10*b.major+1E5*b.minor+b.patch}function H(a,b){for(var f in b)if(b.hasOwnProperty(f))for(var c="{"+f+"}",d=b[f];-1!==a.indexOf(c);)a=a.replace(c,d);return a}function B(a){return"string"===typeof a}function y(a){return"function"===typeof a}function L(a){return"number"===typeof a&&isFinite(a)&&Math.floor(a)===a}function I(a){return"fast"===a||"slow"===a?!0:L(a)?0<=a:!1}function t(a){return B(a)&&-1!==a.search(/^[a-h][1-8]$/)}function ca(a){if(!B(a))return!1;a=a.replace(/ .+$/,
"");a=a.replace(/8/g,"11111111").replace(/7/g,"1111111").replace(/6/g,"111111").replace(/5/g,"11111").replace(/4/g,"1111").replace(/3/g,"111").replace(/2/g,"11");a=a.split("/");if(8!==a.length)return!1;for(var b=0;8>b;b++)if(8!==a[b].length||-1!==a[b].search(/[^kqrnbpKQRNBP1]/))return!1;return!0}function da(a){if(!c.isPlainObject(a))return!1;for(var b in a)if(a.hasOwnProperty(b)){var f;(f=!t(b))||(f=a[b],f=!(B(f)&&-1!==f.search(/^[bw][KQRNBP]$/)));if(f)return!1}return!0}function M(a){a=a.replace(/ .+$/,
"");a=a.split("/");for(var b={},f=8,c=0;8>c;c++){for(var d=a[c].split(""),g=0,l=0;l<d.length;l++)if(-1!==d[l].search(/[1-8]/)){var t=parseInt(d[l],10);g+=t}else{t=F[g]+f;var m=d[l];m=m.toLowerCase()===m?"b"+m.toUpperCase():"w"+m.toUpperCase();b[t]=m;g+=1}--f}return b}function Q(a){for(var b="",f=8,c=0;8>c;c++){for(var d=0;8>d;d++){var g=F[d]+f;a.hasOwnProperty(g)?(g=a[g].split(""),g="w"===g[0]?g[1].toUpperCase():g[1].toLowerCase(),b+=g):b+="1"}7!==c&&(b+="/");--f}return b=b.replace(/11111111/g,"8").replace(/1111111/g,
"7").replace(/111111/g,"6").replace(/11111/g,"5").replace(/1111/g,"4").replace(/111/g,"3").replace(/11/g,"2")}function W(a,b){var f=a.split("");a=F.indexOf(f[0])+1;f=parseInt(f[1],10);var c=b.split("");b=F.indexOf(c[0])+1;c=parseInt(c[1],10);a=Math.abs(a-b);f=Math.abs(f-c);return a>=f?a:f}function qa(a){for(var b=[],f=0;8>f;f++)for(var c=0;8>c;c++){var d=F[f]+(c+1);a!==d&&b.push({square:d,distance:W(a,d)})}b.sort(function(a,b){return a.distance-b.distance});a=[];for(f=0;f<b.length;f++)a.push(b[f].square);
return a}function ra(a){var b='<div class="{chessboard}">';a&&(b+='<div class="{sparePieces} {sparePiecesTop}"></div>');b+='<div class="{board}"></div>';a&&(b+='<div class="{sparePieces} {sparePiecesBottom}"></div>');return H(b+"</div>",g)}function sa(a){"start"===a?a={position:f(X)}:ca(a)?a={position:M(a)}:da(a)&&(a={position:f(a)});c.isPlainObject(a)||(a={});return a}function ta(a){"black"!==a.orientation&&(a.orientation="white");!1!==a.showNotation&&(a.showNotation=!0);!0!==a.draggable&&(a.draggable=
!1);"trash"!==a.dropOffBoard&&(a.dropOffBoard="snapback");!0!==a.sparePieces&&(a.sparePieces=!1);a.sparePieces&&(a.draggable=!0);a.hasOwnProperty("pieceTheme")&&(B(a.pieceTheme)||y(a.pieceTheme))||(a.pieceTheme="img/chesspieces/wikipedia/{piece}.png");I(a.appearSpeed)||(a.appearSpeed=200);I(a.moveSpeed)||(a.moveSpeed=250);I(a.snapbackSpeed)||(a.snapbackSpeed=60);I(a.snapSpeed)||(a.snapSpeed=30);I(a.trashSpeed)||(a.trashSpeed=100);var b=a.dragThrottleRate;L(b)&&1<=b||(a.dragThrottleRate=20);return a}
function ua(a){if(""===a)return window.alert("Chessboard Error 1001: The first argument to Chessboard() cannot be an empty string.\n\nExiting\u2026"),!1;B(a)&&"#"!==a.charAt(0)&&(a="#"+a);a=c(a);return 1!==a.length?(window.alert("Chessboard Error 1003: The first argument to Chessboard() must be the ID of a DOM node, an ID query selector, or a single DOM node.\n\nExiting\u2026"),!1):a}var c=window.jQuery,ea=document.createElement("img");ea.src="img/buttons/build.png";var fa=document.createElement("img");
fa.src="img/buttons/snipe.png";var ha=document.createElement("img");ha.src="img/buttons/cloak.png";var ia=document.createElement("img");ia.src="img/buttons/stun.png";var F="abcdefgh".split(""),X=M("rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR"),g={alpha:"alpha-d2270",black:"black-3c85d",board:"board-b72b1",chessboard:"chessboard-63f37",clearfix:"clearfix-7da63",highlight1:"highlight1-32417",highlight2:"highlight2-9c5d2",notation:"notation-322f9",numeric:"numeric-fc462",piece:"piece-417db",row:"row-5277c",
sparePieces:"spare-pieces-7492f",sparePiecesBottom:"spare-pieces-bottom-ae20f",sparePiecesTop:"spare-pieces-top-4028b",square:"square-55d63",white:"white-1e1d7"};window.Chessboard=function(a,b){function m(e,a,p){if(!0===b.hasOwnProperty("showErrors")&&!1!==b.showErrors){var k="Chessboard Error "+e+": "+a;"console"===b.showErrors&&"object"===typeof console&&"function"===typeof console.log?(console.log(k),2<=arguments.length&&console.log(p)):"alert"===b.showErrors?(p&&(k+="\n\n"+JSON.stringify(p)),
window.alert(k)):y(b.showErrors)&&b.showErrors(e,a,p)}}function I(e){"black"!==e&&(e="white");var a="",p=f(F),z=8;"black"===e&&(p.reverse(),z=1);for(var c="white",d=0;8>d;d++){a+='<div class="{row}">';for(var h=0;8>h;h++){var l=p[h]+z;a+='<div class="{square} '+g[c]+" square-"+l+'" style="width:'+v+"px;height:"+v+'px;" id="'+q[l]+'" data-square="'+l+'">';if(b.showNotation){if("white"===e&&1===z||"black"===e&&8===z)a+='<div class="{notation} {alpha}">'+p[h]+"</div>";0===h&&(a+='<div class="{notation} {numeric}">'+
z+"</div>")}a+="</div>";c="white"===c?"black":"white"}a+='<div class="{clearfix}"></div></div>';c="white"===c?"black":"white";z="white"===e?z-1:z+1}return H(a,g)}function E(e,a,p){if(y(b.pieceTheme))var k=b.pieceTheme(e);else B(b.pieceTheme)?k=H(b.pieceTheme,{piece:e}):(m(8272,"Unable to build image source for config.pieceTheme."),k="");k='<img src="'+k+'" ';B(p)&&""!==p&&(k+='id="'+p+'" ');k+='alt="" class="{piece}" data-piece="'+e+'" style="width:'+v+"px;height:"+v+"px;";a&&(k+="display:none;");
return H(k+'" />',g)}function P(e){var a="wK wQ wR wB wN wP wW".split(" ");"black"===e&&(a="bK bQ bR bB bN bP bW".split(" "));e="";for(var b=0;b<a.length;b++)e+=E(a[b],!1,R[a[b]]);return e}function L(e,a,p,f){e=c("#"+q[e]);var k=e.offset(),z=c("#"+q[a]),d=z.offset(),n=l();c("body").append(E(p,!0,n));var m=c("#"+n);m.css({display:"",position:"absolute",top:k.top,left:k.left});e.find("."+g.piece).remove();m.animate(d,{duration:b.moveSpeed,complete:function(){c("#"+q[a]).find("."+g.piece).remove();z.append(E(p));
m.remove();y(f)&&f()}})}function W(e,a,f){var k=c("#"+R[e]).offset(),p=c("#"+q[a]);a=p.offset();var d=l();c("body").append(E(e,!0,d));var h=c("#"+d);h.css({display:"",position:"absolute",left:k.left,top:k.top});h.animate(a,{duration:b.moveSpeed,complete:function(){p.find("."+g.piece).remove();p.append(E(e));h.remove();y(f)&&f()}})}function pa(e,a,p){function k(){d+=1;if(d===e.length&&(N(),y(b.onMoveEnd)))b.onMoveEnd(f(a),f(p))}if(0!==e.length)for(var d=0,l=0;l<e.length;l++){var h=e[l];"clear"===h.type?
c("#"+q[h.square]+" ."+g.piece).fadeOut(b.trashSpeed,k):"add"!==h.type||b.sparePieces?"add"===h.type&&b.sparePieces?W(h.piece,h.square,k):"move"===h.type&&L(h.source,h.destination,h.piece,k):c("#"+q[h.square]).append(E(h.piece,!0)).find("."+g.piece).fadeIn(b.appearSpeed,k)}}function N(){D.find("."+g.piece).remove();for(var e in n)n.hasOwnProperty(e)&&c("#"+q[e]).append(E(n[e]))}function Y(){D.html(I(w,v,b.showNotation));N();b.sparePieces&&("white"===w?(Z.html(P("black")),aa.html(P("white"))):(Z.html(P("white")),
aa.html(P("black"))))}function S(e){var a=f(n),p=f(e),c=Q(a),d=Q(p);if(c!==d){if(y(b.onChange))b.onChange(a,p);n=e}}function ba(e,a){for(var b in O)if(O.hasOwnProperty(b)){var k=O[b];if(e>=k.left&&e<k.left+v&&a>=k.top&&a<k.top+v)return b}return"offboard"}function T(){D.find("."+g.square).removeClass(g.highlight1+" "+g.highlight2)}function va(){if("spare"===u)ja();else{T();var e=c("#"+q[u]).offset();J.animate(e,{duration:b.snapbackSpeed,complete:function(){N();J.css("display","none");if(y(b.onSnapbackEnd))b.onSnapbackEnd(G,
u,f(n),w)}});C=!1}}function ja(){T();var e=f(n);delete e[u];S(e);N();J.fadeOut(b.trashSpeed);C=!1}function ka(e){T();var a=f(n);delete a[u];a[e]=G;S(a);C=!1}function U(e,a){if(!1!==b.onDragStart(a)){C=!0;G=a;u=e;K="spare"===e?"offboard":e;O={};for(var f in q)q.hasOwnProperty(f)&&(O[f]=c("#"+q[f]).offset());if("spare"!==e){c("#"+q[e]).addClass(g.highlight1);specialSquare=e;specialPiece=a;switch(specialPiece.charAt(1)){case "K":a=ia;break;case "N":a=fa;break;case "R":a=ea;break;case "B":if(c("#"+q[e]).hasClass("cloaked"))return;
a=ha;break;default:return}0<specialMoves(e,specialPiece).length?a.className="special":a.className="special inactive";a.style.display="";document.getElementById(q[e]).appendChild(a)}}}function la(a,k){a=ba(a,k);if(a!==K){t(K)&&c("#"+q[K]).removeClass(g.highlight2);t(a)&&c("#"+q[a]).addClass(g.highlight2);if(y(b.onDragMove))b.onDragMove(a,K,u,G,f(n),w);K=a}}function V(a){var e="drop";"offboard"===a&&"snapback"===b.dropOffBoard&&(e="snapback");"offboard"===a&&"trash"===b.dropOffBoard&&(e="trash");if(y(b.onDrop)){var c=
f(n);"spare"===u&&t(a)&&(c[a]=G);t(u)&&"offboard"===a&&delete c[u];t(u)&&t(a)&&(delete c[u],c[a]=G);var d=f(n);c=b.onDrop(u,a,G,c,d,w);if("snapback"===c||"trash"===c)e=c}"snapback"===e?va():"trash"===e?ja():"drop"===e&&(e=document.getElementsByClassName("square-"+u),e[0].classList.contains("cloaked")?(document.getElementsByClassName("square-"+a)[0].classList.add("cloaked"),ka(a),e[0].classList.remove("cloaked")):(L(u,a,G),ka(a)))}function wa(a){a.preventDefault()}function xa(a){if(a.target.matches(".special")&&
!a.target.parentElement.matches(".cloaked"))if(a.target.matches(".inactive"))V("offboard");else{inSpecial=!0;var e=specialMoves(specialSquare,specialPiece);removeHighlights();c(".special").hide();if("B"==specialPiece.charAt(1))a.target.parentElement.classList.add("cloaked"),specialSquare="offboard",endSpecial(),advanceTurn(),endTurn();else for(a=0;a<e.length;a++)highlightSquare(e[a],"red")}else C?inSpecial?endSpecial():(a=ba(a.pageX,a.pageY),V(a)):b.draggable&&(e=c(this).attr("data-square"),t(e)&&
n.hasOwnProperty(e)&&!a.target.matches(".inactive")&&U(e,n[e]))}function ya(a){b.draggable&&(a=c(this).attr("data-square"),t(a)&&n.hasOwnProperty(a)&&U(a,n[a]))}function za(){if(b.sparePieces){var a=c(this).attr("data-piece");U("spare",a)}}function Aa(a){b.sparePieces&&(a=c(this).attr("data-piece"),U("spare",a))}function Ba(a){C&&(a=ba(a.originalEvent.changedTouches[0].pageX,a.originalEvent.changedTouches[0].pageY),V(a))}function Ca(a){if(!C&&y(b.onMouseoverSquare)&&(a=c(a.currentTarget).attr("data-square"),
t(a))){var e=!1;n.hasOwnProperty(a)&&(e=n[a]);b.onMouseoverSquare(a,e,f(n),w)}}function Da(a){if(!C&&(a=c(a.currentTarget).attr("data-square"),t(a)))b.onMouseoutSquare()}if(typeof window.$&&c.fn&&c.fn.jquery&&x(c.fn.jquery,"1.8.3"))var ma=!0;else window.alert("Chessboard Error 1005: Unable to find a valid version of jQuery. Please include jQuery 1.8.3 or higher on the page\n\nExiting\u2026"),ma=!1;if(!ma)return null;var A=ua(a);if(!A)return null;b=sa(b);b=ta(b);var D=null,J=null,Z=null,aa=null,r=
{},na=2,w="white",n={},G=null,K=null,u=null,C=!1,R={},q={},O={},v=16;r.clear=function(a){r.position({},a)};r.destroy=function(){A.html("");J.remove();A.unbind()};r.fen=function(){return r.position("fen")};r.flip=function(){return r.orientation("flip")};r.move=function(){if(0!==arguments.length){for(var a=!0,b={},c=0;c<arguments.length;c++)if(!1===arguments[c])a=!1;else{var d=arguments[c];B(d)?(d=d.split("-"),d=2!==d.length?!1:t(d[0])&&t(d[1])):d=!1;d?(d=arguments[c].split("-"),b[d[0]]=d[1]):m(2826,
"Invalid move passed to the move method.",arguments[c])}c=f(n);for(var g in b)b.hasOwnProperty(g)&&c.hasOwnProperty(g)&&(d=c[g],delete c[g],c[b[g]]=d);r.position(c,a);return c}};r.orientation=function(a){if(0===arguments.length)return w;if("white"===a||"black"===a)return w=a,Y(),w;if("flip"===a)return w="white"===w?"black":"white",Y(),w;m(5482,"Invalid value passed to the orientation method.",a)};r.position=function(a,b){if(0===arguments.length)return f(n);if(B(a)&&"fen"===a.toLowerCase())return Q(n);
a=B(a)&&"start"===a.toLowerCase()?f(X):M(a);!1!==b&&(b=!0);if(b){var e=n,c=a;e=f(e);c=f(c);var d=[],g={},h;for(h in c)c.hasOwnProperty(h)&&e.hasOwnProperty(h)&&e[h]===c[h]&&(delete e[h],delete c[h]);for(h in c)if(c.hasOwnProperty(h)){a:{var k=e;for(var l=c[h],m=qa(h),q=0;q<m.length;q++){var r=m[q];if(k.hasOwnProperty(r)&&k[r]===l){k=r;break a}}k=!1}k&&(d.push({type:"move",source:k,destination:h,piece:c[h]}),delete e[k],delete c[h],g[h]=!0)}for(h in c)c.hasOwnProperty(h)&&(d.push({type:"add",square:h,
piece:c[h]}),delete c[h]);for(h in e)e.hasOwnProperty(h)&&!g.hasOwnProperty(h)&&(d.push({type:"clear",square:h,piece:e[h]}),delete e[h]);pa(d,n,a);S(a)}else S(a),N()};r.resize=function(){var a=parseInt(A.width(),10);if(!a||0>=a)v=0;else{for(--a;0!==a%8&&0<a;)--a;v=a/8}D.css("width",8*v+"px");J.css({height:v,width:v});b.sparePieces&&A.find("."+g.sparePieces).css("paddingLeft",v+na+"px");Y()};r.removeYellowHighlights=function(){T()};r.start=function(a){r.position("start",a)};r.stopDraggedPiece=function(a){V(a)};
var Ea=d(function(a){C&&la(a.pageX,a.pageY)},b.dragThrottleRate),Fa=d(function(a){C&&(a.preventDefault(),la(a.originalEvent.changedTouches[0].pageX,a.originalEvent.changedTouches[0].pageY))},b.dragThrottleRate);w=b.orientation;b.hasOwnProperty("position")&&("start"===b.position?n=f(X):ca(b.position)?n=M(b.position):da(b.position)?n=f(b.position):m(7263,"Invalid value passed to config.position.",b.position));(function(){for(var a=0;a<F.length;a++)for(var d=1;8>=d;d++){var f=F[a]+d;q[f]=f+"-"+l()}d=
"KQRNBP".split("");for(a=0;a<d.length;a++){f="w"+d[a];var m="b"+d[a];R[f]=f+"-"+l();R[m]=m+"-"+l()}A.html(ra(b.sparePieces));D=A.find("."+g.board);b.sparePieces&&(Z=A.find("."+g.sparePiecesTop),aa=A.find("."+g.sparePiecesBottom));a=l();c("body").append(E("wP",!0,a));J=c("#"+a);na=parseInt(D.css("borderLeftWidth"),10);r.resize()})();(function(){c("body").on("mousedown mousemove","."+g.piece,wa);D.on("mouseup","."+g.square,xa);A.on("mouseup","."+g.sparePieces+" ."+g.piece,za);D.on("mouseenter","."+
g.square,Ca).on("mouseleave","."+g.square,Da);var a=c(window);a.on("mousemove",Ea);"ontouchstart"in document.documentElement&&(D.on("touchstart","."+g.square,ya),A.on("touchstart","."+g.sparePieces+" ."+g.piece,Aa),a.on("touchmove",Fa).on("touchend",Ba))})();return r};window.Chessboard.fenToObj=M;window.Chessboard.objToFen=Q})();
