/*! chessboard.js | (c) 2013 Chris Oakman | | Forked from v0.3.0 by Cody Mims | MIT License chessboardjs.com/license */
(function(){function ja(b,d,h){var l=0,n=!1,r=[],E=function(){l=0;n&&(n=!1,K())},K=function(){l=window.setTimeout(E,d);b.apply(h,r)};return function(y){r=arguments;l?n=!0:K()}}function N(){return"xxxx-xxxx-xxxx-xxxx-xxxx-xxxx-xxxx-xxxx".replace(/x/g,function(b){return(16*Math.random()|0).toString(16)})}function t(b){return JSON.parse(JSON.stringify(b))}function ka(b){b=b.split(".");return{major:parseInt(b[0],10),minor:parseInt(b[1],10),patch:parseInt(b[2],10)}}function xa(b,d){b=ka(b);d=ka(d);return 1E10*
b.major+1E5*b.minor+b.patch>=1E10*d.major+1E5*d.minor+d.patch}function U(b,d){for(var h in d)if(d.hasOwnProperty(h))for(var l="{"+h+"}",n=d[h];-1!==b.indexOf(l);)b=b.replace(l,n);return b}function H(b){return"string"===typeof b}function F(b){return"function"===typeof b}function la(b){return"number"===typeof b&&isFinite(b)&&Math.floor(b)===b}function R(b){return"fast"===b||"slow"===b?!0:la(b)?0<=b:!1}function z(b){return H(b)&&-1!==b.search(/^[a-h][1-8]$/)}function ma(b){if(!H(b))return!1;b=b.replace(/ .+$/,
"");b=b.replace(/8/g,"11111111").replace(/7/g,"1111111").replace(/6/g,"111111").replace(/5/g,"11111").replace(/4/g,"1111").replace(/3/g,"111").replace(/2/g,"11");b=b.split("/");if(8!==b.length)return!1;for(var d=0;8>d;d++)if(8!==b[d].length||-1!==b[d].search(/[^kqrnbpKQRNBP1]/))return!1;return!0}function na(b){if(!k.isPlainObject(b))return!1;for(var d in b)if(b.hasOwnProperty(d)){var h;(h=!z(d))||(h=b[d],h=!(H(h)&&-1!==h.search(/^[bw][KQRNBP]$/)));if(h)return!1}return!0}function S(b){b=b.replace(/ .+$/,
"");b=b.split("/");for(var d={},h=8,l=0;8>l;l++){for(var n=b[l].split(""),r=0,E=0;E<n.length;E++)if(-1!==n[E].search(/[1-8]/)){var K=parseInt(n[E],10);r+=K}else{K=L[r]+h;var y=n[E];y=y.toLowerCase()===y?"b"+y.toUpperCase():"w"+y.toUpperCase();d[K]=y;r+=1}--h}return d}function V(b){for(var d="",h=8,l=0;8>l;l++){for(var n=0;8>n;n++){var r=L[n]+h;b.hasOwnProperty(r)?(r=b[r].split(""),r="w"===r[0]?r[1].toUpperCase():r[1].toLowerCase(),d+=r):d+="1"}7!==l&&(d+="/");--h}return d=d.replace(/11111111/g,"8").replace(/1111111/g,
"7").replace(/111111/g,"6").replace(/11111/g,"5").replace(/1111/g,"4").replace(/111/g,"3").replace(/11/g,"2")}function ya(b,d){var h=b.split(""),l=L.indexOf(h[0])+1;h=parseInt(h[1],10);var n=d.split(""),r=L.indexOf(n[0])+1;n=parseInt(n[1],10);l=Math.abs(l-r);h=Math.abs(h-n);return l>=h?l:h}function za(b){for(var d=[],h=0;8>h;h++)for(var l=0;8>l;l++){var n=L[h]+(l+1);b!==n&&d.push({square:n,distance:ya(b,n)})}d.sort(function(r,E){return r.distance-E.distance});b=[];for(h=0;h<d.length;h++)b.push(d[h].square);
return b}function Aa(b){"start"===b?b={position:t(ba)}:ma(b)?b={position:S(b)}:na(b)&&(b={position:t(b)});k.isPlainObject(b)||(b={});return b}function Ba(b){"black"!==b.orientation&&(b.orientation="white");!1!==b.showNotation&&(b.showNotation=!0);!0!==b.draggable&&(b.draggable=!1);"trash"!==b.dropOffBoard&&(b.dropOffBoard="snapback");!0!==b.sparePieces&&(b.sparePieces=!1);b.sparePieces&&(b.draggable=!0);b.hasOwnProperty("pieceTheme")&&(H(b.pieceTheme)||F(b.pieceTheme))||(b.pieceTheme="img/chesspieces/wikipedia/{piece}.png");
R(b.appearSpeed)||(b.appearSpeed=200);R(b.moveSpeed)||(b.moveSpeed=250);R(b.snapbackSpeed)||(b.snapbackSpeed=60);R(b.snapSpeed)||(b.snapSpeed=30);R(b.trashSpeed)||(b.trashSpeed=100);var d=b.dragThrottleRate;la(d)&&1<=d||(b.dragThrottleRate=20);return b}function Ca(b){if(""===b)return window.alert("Chessboard Error 1001: The first argument to Chessboard() cannot be an empty string.\n\nExiting\u2026"),!1;H(b)&&"#"!==b.charAt(0)&&(b="#"+b);b=k(b);return 1!==b.length?(window.alert("Chessboard Error 1003: The first argument to Chessboard() must be the ID of a DOM node, an ID query selector, or a single DOM node.\n\nExiting\u2026"),
!1):b}var k=window.jQuery,oa=document.createElement("img");oa.src="img/buttons/build.png";var pa=document.createElement("img");pa.src="img/buttons/snipe.png";var qa=document.createElement("img");qa.src="img/buttons/cloak.png";var ra=document.createElement("img");ra.src="img/buttons/stun.png";var L="abcdefgh".split(""),ba=S("rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR"),m={alpha:"alpha-d2270",black:"black-3c85d",board:"board-b72b1",chessboard:"chessboard-63f37",clearfix:"clearfix-7da63",highlight1:"highlight1-32417",
highlight2:"highlight2-9c5d2",notation:"notation-322f9",numeric:"numeric-fc462",piece:"piece-417db",row:"row-5277c",sparePieces:"spare-pieces-7492f",sparePiecesBottom:"spare-pieces-bottom-ae20f",sparePiecesTop:"spare-pieces-top-4028b",square:"square-55d63",white:"white-1e1d7"};window.Chessboard=function(b,d){function h(a,e,c){if(!0===d.hasOwnProperty("showErrors")&&!1!==d.showErrors){var f="Chessboard Error "+a+": "+e;"console"===d.showErrors&&"object"===typeof console&&"function"===typeof console.log?
(console.log(f),2<=arguments.length&&console.log(c)):"alert"===d.showErrors?(c&&(f+="\n\n"+JSON.stringify(c)),window.alert(f)):F(d.showErrors)&&d.showErrors(a,e,c)}}function l(a,e,c){if(F(d.pieceTheme))var f=d.pieceTheme(a);else H(d.pieceTheme)?f=U(d.pieceTheme,{piece:a}):(h(8272,"Unable to build image source for config.pieceTheme."),f="");f='<img src="'+f+'" ';H(c)&&""!==c&&(f+='id="'+c+'" ');f+='alt="" class="{piece}" data-piece="'+a+'" style="width:'+C+"px;height:"+C+"px;";e&&(f+="display:none;");
return U(f+'" />',m)}function n(a){var e="wK wQ wR wB wN wP wW".split(" ");"black"===a&&(e="bK bQ bR bB bN bP bW".split(" "));a="";for(var c=0;c<e.length;c++)a+=l(e[c],!1,W[e[c]]);return a}function r(a,e,c,f){a=k("#"+v[a]);var p=a.offset(),u=k("#"+v[e]),g=u.offset(),A=N();k("body").append(l(c,!0,A));var G=k("#"+A);G.css({display:"",position:"absolute",top:p.top,left:p.left});a.find("."+m.piece).remove();G.animate(g,{duration:d.moveSpeed,complete:function(){k("#"+v[e]).find("."+m.piece).remove();u.append(l(c));
G.remove();F(f)&&f()}})}function E(a,e,c){var f=k("#"+W[a]).offset(),p=k("#"+v[e]);e=p.offset();var u=N();k("body").append(l(a,!0,u));var g=k("#"+u);g.css({display:"",position:"absolute",left:f.left,top:f.top});g.animate(e,{duration:d.moveSpeed,complete:function(){p.find("."+m.piece).remove();p.append(l(a));g.remove();F(c)&&c()}})}function K(a,e,c){function f(){p+=1;if(p===a.length&&(y(),F(d.onMoveEnd)))d.onMoveEnd(t(e),t(c))}if(0!==a.length)for(var p=0,u=0;u<a.length;u++){var g=a[u];"clear"===g.type?
k("#"+v[g.square]+" ."+m.piece).fadeOut(d.trashSpeed,f):"add"!==g.type||d.sparePieces?"add"===g.type&&d.sparePieces?E(g.piece,g.square,f):"move"===g.type&&r(g.source,g.destination,g.piece,f):k("#"+v[g.square]).append(l(g.piece,!0)).find("."+m.piece).fadeIn(d.appearSpeed,f)}}function y(){J.find("."+m.piece).remove();for(var a in q)q.hasOwnProperty(a)&&k("#"+v[a]).append(l(q[a]))}function ca(){var a=J,e=a.html;var c=B;"black"!==c&&(c="white");var f="",p=t(L),u=8;"black"===c&&(p.reverse(),u=1);for(var g=
"white",A=0;8>A;A++){f+='<div class="{row}">';for(var G=0;8>G;G++){var O=p[G]+u;f+='<div class="{square} '+m[g]+" square-"+O+'" style="width:'+C+"px;height:"+C+'px;" id="'+v[O]+'" data-square="'+O+'">';if(d.showNotation){if("white"===c&&1===u||"black"===c&&8===u)f+='<div class="{notation} {alpha}">'+p[G]+"</div>";0===G&&(f+='<div class="{notation} {numeric}">'+u+"</div>")}f+="</div>";g="white"===g?"black":"white"}f+='<div class="{clearfix}"></div></div>';g="white"===g?"black":"white";u="white"===
c?u-1:u+1}c=U(f,m);e.call(a,c);y();d.sparePieces&&("white"===B?(da.html(n("black")),ea.html(n("white"))):(da.html(n("white")),ea.html(n("black"))))}function X(a){var e=t(q),c=t(a),f=V(e),p=V(c);if(f!==p){if(F(d.onChange))d.onChange(e,c);q=a}}function fa(a,e){for(var c in T)if(T.hasOwnProperty(c)){var f=T[c];if(a>=f.left&&a<f.left+C&&e>=f.top&&e<f.top+C)return c}return"offboard"}function Y(){J.find("."+m.square).removeClass(m.highlight1+" "+m.highlight2)}function Da(){if("spare"===x)sa();else{Y();
var a=k("#"+v[x]).offset();P.animate(a,{duration:d.snapbackSpeed,complete:function(){y();P.css("display","none");if(F(d.onSnapbackEnd))d.onSnapbackEnd(M,x,t(q),B)}});I=!1}}function sa(){Y();var a=t(q);delete a[x];X(a);y();P.fadeOut(d.trashSpeed);I=!1}function ta(a){Y();var e=t(q);delete e[x];e[a]=M;X(e);I=!1}function Z(a,e){if(!1!==d.onDragStart(e)){I=!0;M=e;x=a;Q="spare"===a?"offboard":a;T={};for(var c in v)v.hasOwnProperty(c)&&(T[c]=k("#"+v[c]).offset());if("spare"!==a){k("#"+v[a]).addClass(m.highlight1);
specialSquare=a;specialPiece=e;switch(specialPiece.charAt(1)){case "K":c=ra;break;case "N":c=pa;break;case "R":c=oa;break;case "B":if(k("#"+v[a]).hasClass("cloaked"))return;c=qa;break;default:return}0<specialMoves(a,specialPiece).length?c.className="special":c.className="special inactive";c.style.display="";document.getElementById(v[a]).appendChild(c)}}}function ua(a,e){var c=fa(a,e);if(c!==Q){z(Q)&&k("#"+v[Q]).removeClass(m.highlight2);z(c)&&k("#"+v[c]).addClass(m.highlight2);if(F(d.onDragMove))d.onDragMove(c,
Q,x,M,t(q),B);Q=c}}function aa(a){var e="drop";"offboard"===a&&"snapback"===d.dropOffBoard&&(e="snapback");"offboard"===a&&"trash"===d.dropOffBoard&&(e="trash");if(F(d.onDrop)){var c=t(q);"spare"===x&&z(a)&&(c[a]=M);z(x)&&"offboard"===a&&delete c[x];z(x)&&z(a)&&(delete c[x],c[a]=M);var f=t(q);c=d.onDrop(x,a,M,c,f,B);if("snapback"===c||"trash"===c)e=c}"snapback"===e?Da():"trash"===e?sa():"drop"===e&&(e=document.getElementsByClassName("square-"+x),e[0].classList.contains("cloaked")?(document.getElementsByClassName("square-"+
a)[0].classList.add("cloaked"),ta(a),e[0].classList.remove("cloaked")):(r(x,a,M),ta(a)))}function Ea(a){a.preventDefault()}function Fa(a){if(a.target.matches(".special")&&!a.target.parentElement.matches(".cloaked"))if(a.target.matches(".inactive"))aa("offboard");else{inSpecial=!0;var e=specialMoves(specialSquare,specialPiece);removeHighlights();k(".special").hide();if("B"==specialPiece.charAt(1))a.target.parentElement.classList.add("cloaked"),specialSquare="offboard",endSpecial(),advanceTurn(),endTurn();
else for(a=0;a<e.length;a++)highlightSquare(e[a],"red")}else I?inSpecial?endSpecial():(a=fa(a.pageX,a.pageY),aa(a)):d.draggable&&(e=k(this).attr("data-square"),z(e)&&q.hasOwnProperty(e)&&!a.target.matches(".inactive")&&Z(e,q[e]))}function Ga(a){d.draggable&&(a=k(this).attr("data-square"),z(a)&&q.hasOwnProperty(a)&&Z(a,q[a]))}function Ha(){if(d.sparePieces){var a=k(this).attr("data-piece");Z("spare",a)}}function Ia(a){d.sparePieces&&(a=k(this).attr("data-piece"),Z("spare",a))}function Ja(a){I&&(a=
fa(a.originalEvent.changedTouches[0].pageX,a.originalEvent.changedTouches[0].pageY),aa(a))}function Ka(a){if(!I&&F(d.onMouseoverSquare)&&(a=k(a.currentTarget).attr("data-square"),z(a))){var e=!1;q.hasOwnProperty(a)&&(e=q[a]);d.onMouseoverSquare(a,e,t(q),B)}}function La(a){if(!I&&(a=k(a.currentTarget).attr("data-square"),z(a)))d.onMouseoutSquare()}if(typeof window.$&&k.fn&&k.fn.jquery&&xa(k.fn.jquery,"1.8.3"))var va=!0;else window.alert("Chessboard Error 1005: Unable to find a valid version of jQuery. Please include jQuery 1.8.3 or higher on the page\n\nExiting\u2026"),
va=!1;if(!va)return null;var D=Ca(b);if(!D)return null;d=Aa(d);d=Ba(d);var J=null,P=null,da=null,ea=null,w={},wa=2,B="white",q={},M=null,Q=null,x=null,I=!1,W={},v={},T={},C=16;w.clear=function(a){w.position({},a)};w.destroy=function(){D.html("");P.remove();D.unbind()};w.fen=function(){return w.position("fen")};w.flip=function(){return w.orientation("flip")};w.move=function(){if(0!==arguments.length){for(var a=!0,e={},c=0;c<arguments.length;c++)if(!1===arguments[c])a=!1;else{var f=arguments[c];H(f)?
(f=f.split("-"),f=2!==f.length?!1:z(f[0])&&z(f[1])):f=!1;f?(f=arguments[c].split("-"),e[f[0]]=f[1]):h(2826,"Invalid move passed to the move method.",arguments[c])}c=t(q);for(var p in e)e.hasOwnProperty(p)&&c.hasOwnProperty(p)&&(f=c[p],delete c[p],c[e[p]]=f);w.position(c,a);return c}};w.orientation=function(a){if(0===arguments.length)return B;if("white"===a||"black"===a)return B=a,ca(),B;if("flip"===a)return B="white"===B?"black":"white",ca(),B;h(5482,"Invalid value passed to the orientation method.",
a)};w.position=function(a,e){if(0===arguments.length)return t(q);if(H(a)&&"fen"===a.toLowerCase())return V(q);a=H(a)&&"start"===a.toLowerCase()?t(ba):S(a);!1!==e&&(e=!0);if(e){var c=q,f=a;c=t(c);f=t(f);var p=[],u={},g;for(g in f)f.hasOwnProperty(g)&&c.hasOwnProperty(g)&&c[g]===f[g]&&(delete c[g],delete f[g]);for(g in f)if(f.hasOwnProperty(g)){a:{var A=c;for(var G=f[g],O=za(g),ha=0;ha<O.length;ha++){var ia=O[ha];if(A.hasOwnProperty(ia)&&A[ia]===G){A=ia;break a}}A=!1}A&&(p.push({type:"move",source:A,
destination:g,piece:f[g]}),delete c[A],delete f[g],u[g]=!0)}for(g in f)f.hasOwnProperty(g)&&(p.push({type:"add",square:g,piece:f[g]}),delete f[g]);for(g in c)c.hasOwnProperty(g)&&!u.hasOwnProperty(g)&&(p.push({type:"clear",square:g,piece:c[g]}),delete c[g]);K(p,q,a);X(a)}else X(a),y()};w.resize=function(){var a=parseInt(D.width(),10);if(!a||0>=a)C=0;else{for(--a;0!==a%8&&0<a;)--a;C=a/8}J.css("width",8*C+"px");P.css({height:C,width:C});d.sparePieces&&D.find("."+m.sparePieces).css("paddingLeft",C+wa+
"px");ca()};w.removeYellowHighlights=function(){Y()};w.start=function(a){w.position("start",a)};w.stopDraggedPiece=function(a){aa(a)};var Ma=ja(function(a){I&&ua(a.pageX,a.pageY)},d.dragThrottleRate),Na=ja(function(a){I&&(a.preventDefault(),ua(a.originalEvent.changedTouches[0].pageX,a.originalEvent.changedTouches[0].pageY))},d.dragThrottleRate);B=d.orientation;d.hasOwnProperty("position")&&("start"===d.position?q=t(ba):ma(d.position)?q=S(d.position):na(d.position)?q=t(d.position):h(7263,"Invalid value passed to config.position.",
d.position));(function(){for(var a=0;a<L.length;a++)for(var e=1;8>=e;e++){var c=L[a]+e;v[c]=c+"-"+N()}e="KQRNBP".split("");for(a=0;a<e.length;a++){c="w"+e[a];var f="b"+e[a];W[c]=c+"-"+N();W[f]=f+"-"+N()}a=D.html;e=d.sparePieces;c='<div class="{chessboard}">';e&&(c+='<div class="{sparePieces} {sparePiecesTop}"></div>');c+='<div class="{board}"></div>';e&&(c+='<div class="{sparePieces} {sparePiecesBottom}"></div>');e=U(c+"</div>",m);a.call(D,e);J=D.find("."+m.board);d.sparePieces&&(da=D.find("."+m.sparePiecesTop),
ea=D.find("."+m.sparePiecesBottom));a=N();k("body").append(l("wP",!0,a));P=k("#"+a);wa=parseInt(J.css("borderLeftWidth"),10);w.resize()})();(function(){k("body").on("mousedown mousemove","."+m.piece,Ea);J.on("mouseup","."+m.square,Fa);D.on("mouseup","."+m.sparePieces+" ."+m.piece,Ha);J.on("mouseenter","."+m.square,Ka).on("mouseleave","."+m.square,La);var a=k(window);a.on("mousemove",Ma);"ontouchstart"in document.documentElement&&(J.on("touchstart","."+m.square,Ga),D.on("touchstart","."+m.sparePieces+
" ."+m.piece,Ia),a.on("touchmove",Na).on("touchend",Ja))})();return w};window.Chessboard.fenToObj=S;window.Chessboard.objToFen=V})();